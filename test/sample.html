<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feature Layer Authentication</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.27/"></script>
</head>

<body>
  <div id="viewDiv" style="height: 100vh;">
  </div>

</body>
<script>
  require([
    "esri/Map",
    "esri/views/MapView",
    "esri/layers/FeatureLayer",
    "esri/identity/OAuthInfo",
    "esri/identity/IdentityManager",
    "esri/config",
    "esri/rest/support/Query",
  ], function (Map, MapView, FeatureLayer, OAuthInfo, IdentityManager, esriConfig, Query) {

    // OAuth configuration
    const oauthInfo = new OAuthInfo({
      appId: "93ypiaCdiAJx888j", // Replace with your app's Client ID
      portalUrl: "https://www.arcgis.com",
      popupCallbackUrl: "https://slmaravilla.github.io/test/sample.html",
      popup: true // Use popup for authentication
    });

    IdentityManager.registerOAuthInfos([oauthInfo]);

    // Automatically sign in the user
    IdentityManager.checkSignInStatus(oauthInfo.portalUrl)
      .then(() => {
        console.log("User is signed in!");
      })
      .catch(() => {
        // If not signed in, initiate OAuth sign-in
        IdentityManager.getCredential(oauthInfo.portalUrl);
      });

    // esriConfig.apiKey= "AAPTxy8BH1VEsoebNVZXo8HurFkVGPgJ7cL1Czgdr2gflF_Q2gQ6Uxrbx12e3cCkn87Iz385w_Giy8QLKThqcrZdOx05NyQTGjsjALZvjmNgnyTIASQNdfpRLTP88SoTGyqEpn0AqtJWYXk9_tJCM_6j5N4gijO6A9PXm7bEOu-HdISgVaHeIAiB5VZGyfuRQtBgBUhcjIWBGE4futSAAI_9GisfgepoEQbvNVBMctFL9Dxa3PDEkoq6E0r22wlB6k-MAT1_Twbuaeih";

    // Create a map
    const map = new Map({
      basemap: "topo-vector"
    });

    // Create a MapView
    const view = new MapView({
      container: "viewDiv",
      map: map,
      center: [120.9842, 14.5995], // Example: Manila coordinates
      zoom: 12
    });

    // Add the feature layer
    const featureLayer = new FeatureLayer({
      url: "https://services8.arcgis.com/h9TUF6x5VzqLQaYx/arcgis/rest/services/Test_Dataset_Clone_to_Portal/FeatureServer", // Replace with your feature layer URL
      outFields: ["*"],
      layerId: 0,
      popupEnabled: true,
    });
    map.add(featureLayer);

    const featureLayer2 = new FeatureLayer({
      url: "https://services8.arcgis.com/h9TUF6x5VzqLQaYx/arcgis/rest/services/SC_PROW/FeatureServer", // Replace with your feature layer URL
      outFields: ["*"],
    });
    map.add(featureLayer2);


    var query = featureLayer.createQuery();
    query.where = "Station = 'Depot'";
    featureLayer.queryFeatures(query)
    .then(function(response){
      const stats = response.features;
      console.log(stats);
    });


  });
</script>

</html> -->


<!DOCTYPE html>

<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no" />
  <title>ArcGIS Maps SDK for JavaScript Tutorials: Implement user authentication</title>


  <link rel="stylesheet" href="https://js.arcgis.com/4.31/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.31/"></script>

  <style>
    html,
    body {
      font-size: 150%;
      margin: 10vh 10vw;
    }
  </style>

  <script>

    require([
      "esri/portal/Portal",
      "esri/identity/OAuthInfo",
      "esri/identity/IdentityManager"
    ], function (Portal, OAuthInfo, esriId) {

      const info = new OAuthInfo({
        appId: "93ypiaCdiAJx888j",
        popupCallbackUrl: "https://slmaravilla.github.io/test/sample.html",
        popup: false // the default
      });
      esriId.registerOAuthInfos([info]);

      esriId
        .checkSignInStatus(info.portalUrl + "/sharing")
        .then(() => {
          handleSignedIn();
        })

        .catch(() => {
          handleSignedOut();

        });

      document.getElementById("sign-in").addEventListener("click", function () {
        esriId.getCredential(info.portalUrl + "/sharing");
      });

      document.getElementById("sign-out").addEventListener("click", function () {
        esriId.destroyCredentials();
        window.location.reload();
      });

      function handleSignedIn() {

        const portal = new Portal();
        portal.load().then(() => {
          const results = { name: portal.user.fullName, username: portal.user.username };
          document.getElementById("results").innerText = JSON.stringify(results, null, 2);
        });

      }

      function handleSignedOut() {
        document.getElementById("results").innerText = 'Signed Out'
      }

    });
  </script>

</head>

<body>

  <button id="sign-in" class="btn btn-primary">Sign In</button>
  <button id="sign-out" class="btn btn-primary">Sign Out</button>
  <pre><code id="results"></code></pre>

</body>

</html>